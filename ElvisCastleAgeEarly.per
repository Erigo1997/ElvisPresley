(defconst num-castle-age-villagers 80)
(defconst num-knight-squad 4)

(defrule
(goal goal-past-feudal TRUE)
(building-type-count-total stable < 3)
(can-build stable)
=>
(build stable)
)

; Let's research the essential blacksmith stuff.
(defrule
(can-research ri-iron-casting)
=>
(research ri-iron-casting)
)

(defrule
(can-research ri-chain-barding)
=>
(research ri-chain-barding)
)

; Let's train some knights!.
(defrule
(goal goal-past-feudal TRUE)
(unit-type-count-total knight-line <= 30)
(can-afford-unit knight-line)
=>
(train knight-line)
)

; If they're ready to rock - again - let's roll!
(defrule
(not(town-under-attack))
(unit-type-count-total knight-line > num-knight-squad)
=>
(attack-now)
(chat-to-all "Here comes the one for the money.")
(disable-self)
)

(defrule
(current-age == castle-age)
(unit-type-count-total villager < num-castle-age-villagers)
(can-train villager)
=>
(train villager)
)

(defrule
(true)
(goal goal-past-feudal TRUE)
(unit-type-count-total knight-line > num-knight-squad)
(can-build watch-tower-line)
=>
(build-forward watch-tower-line)
(disable-self)
)

(defrule
(goal goal-past-feudal TRUE)
(building-type-count-total town-center < 3)
(can-build town-center)
=>
(build town-center)
)

(defrule
(goal goal-past-feudal TRUE)
(building-type-count-total castle < 1)
(can-build castle)
=>
(build castle)
)


